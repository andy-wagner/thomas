<html><head><title>thomas: Core API</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="@kailuowang" /><meta name="description" content="Thomas, a library for A/B tests" /><meta name="og:image" content="/thomas/img/poster.png" /><meta name="og:title" content="thomas: Core API" /><meta name="og:site_name" content="thomas" /><meta name="og:url" content="https://github.com/iheartradio/thomas" /><meta name="og:type" content="website" /><meta name="og:description" content="Thomas, a library for A/B tests" /><link rel="icon" type="image/png" href="/thomas/img/favicon.png" /><meta name="twitter:title" content="thomas: Core API" /><meta name="twitter:image" content="https://github.com/iheartradio/thomasimg/poster.png" /><meta name="twitter:description" content="Thomas, a library for A/B tests" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/thomas/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/thomas/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/thomas/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/thomas/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/thomas/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/thomas/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/thomas/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/thomas/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/thomas/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/thomas/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/thomas/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/thomas/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/thomas/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/thomas/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/thomas/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/thomas/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/thomas/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/thomas/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/thomas/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/thomas/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/thomas/highlight/styles/atom-one-light.css" /><link rel="stylesheet" href="/thomas/css/style.css" /><link rel="stylesheet" href="/thomas/css/palette.css" /><link rel="stylesheet" href="/thomas/css/codemirror.css" /></head><body><header id="site-header"><div class="navbar-wrapper navbar-inverse"><div class="container"><div class="navbar-header"><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/thomas/" class="brand"><div class="icon-wrapper"><span>thomas</span></div></a></div><nav class="text-right"><ul class=""><li><a href="https://github.com/Kailuo Wang/thomas"><i class="fa fa-github"></i><span class="hidden-xs">GitHub</span></a></li><li><a href="/thomas/api/com/iheart/thomas/index.html"><i class="fa fa-file-text"></i><span class="hidden-xs">API Documentation</span></a></li></ul></nav></div></div><div class="jumbotron" style="background-image:url('/thomas/img/jumbotron_pattern.png')"></div><div><ul class="horizontalNav">     <li><a class="" href="/thomas/">Home</a></li>  <li><a class="" href="/thomas/get-started.html">Get Started</a></li>  <li><a class=" active " href="/thomas/core.html">Core API</a></li> </ul></div></header><main id="site-main"><section class="use"><div class="container"><div id="content"><p>Here are the core concepts in Thomas.</p>

<ul>
  <li>
    <p>Feature - a string representing a feature in the product to be A/B tested. A/B tests in Thomas are organized by the feature they are testing against. For each feature there is at most one ongoing test at a specific time. A/B test treatment group assignments are by features, no by specific tests. That is, when Thomas receives an inquiry about the treatment group assignments for a user, it returns a list of pairs of feature and group name. Specific test ids are hidden from such inquiries. For a client to determine which treatment to give for a feature, all it needs is the assigned group name for that feature.</p>
  </li>
  <li>
    <p>A/B test - represents a single experiment that gives different treatments to different groups of users for a certain feature during a period of time. It’s often that people run multiple rounds of A/B tests to determine the optimal treatment for a feature. In Thomas, users can create one A/B test after another testing a specific feature. This series of A/B tests can be deemed as evolving versions of the experiment. The A/B test meta data becomes immutable after it starts. To revise a running A/B test experiment, user has to terminate it and start a new one. This immutability is required to guarantee the correctness of the history as well as enabling the distributed assignment computation.</p>
  </li>
  <li>
    <p>Eligibility Control - mechanism to determine which users are eligible for which experiments. When a feature is not available to certain users, it is desirable to avoid providing any group assignment for these users. For one thing, it would be simply incorrect and may become source of false report in analytic data. This also allows targeting a subset of all users for a certain experiment.</p>
  </li>
  <li>
    <p>Overrides - to fix group assignment for certain users. User assignment is stochastic which could be tricky when QAing an A/B tests. Overrides allow users to fix group assignments for certain users so that QA can test expected behavior from the product for those users.</p>
  </li>
  <li>
    <p>Group Meta - a meta data associated with a treatment group that is included in group assignment response. This metadata could potentially be used to determine the treatment end-user receives. Client could, instead of hard code different behavior based on group names, use some configuration to control the behavior. The group meta can provide such configurations. Thus different group can result in different treatment with different configuration in their group meta.</p>
  </li>
  <li>
    <p>User Meta - more advanced mechanism for eligibility control. When client send a group assignment inquiry request, it can include a user metadata which then can be used to determine which users are eligible for which tests. The A/B tests can be set with a matchingUserMeta which is a list of pairs of field name and regex. Only users whose user meta field value matches the regex are eligible for the experiment.</p>
  </li>
</ul>

<h3 id="ab-test-meta-data">A/B Test meta data</h3>

<p>It represents the meta data regarding an A/B test experiment. Here is example A/B test presented in Json as in returned by service.</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"A/B test against model v1.0"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"feature"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Data Model"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"author"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Kai"</span><span class="p">,</span><span class="w"> 
  </span><span class="nt">"start"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-09-21T00:00:00.001-04:00"</span><span class="p">,</span><span class="w">  
  </span><span class="nt">"end"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-09-27T23:59:59.999-04:00"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"groups"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> 
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"A"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"size"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.5</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"B"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"size"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.5</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nt">"requiredTags"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
  </span><span class="nt">"alternativeIdName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"deviceId"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"matchingUserMeta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"age"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^2\d$"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"reshuffle"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nt">"segmentRanges"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"start"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
      </span><span class="nt">"end"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.5</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></code></pre>
</div>

<p><strong>name</strong>: name of the test, it’s more like a note/description, <strong>it is NOT an identifier</strong>.</p>

<p><strong>feature</strong>: feature name of the treatment. This is an identifier with which feature code can determine for each user which treatment they get.</p>

<p><strong>author</strong>: another notes field</p>

<p><strong>start</strong>: start of the test</p>

<p><strong>end</strong>: end of the test, optional, if not given the test will last indefinitely</p>

<p><strong>groups</strong>: group definitions. group sizes don’t have to add up to 1, but they cannot go beyond 1. If the sum group size is less than 1, it means that there is a portion (1 - the sum group size) of users won’t be the in tests at all, you could make this group your control group.</p>

<p><strong>requiredTags</strong>: an array of string tags for eligibility control. Once set, only users having these tags (tags are passed in group assignment inquiry requests) are eligible for this test.</p>

<p><strong>alternativeIdName</strong>: by default Thomas uses the “userId” field passed in the group assignment inquiry request as the unique identification for segmenting users. In some A/B test cases, e.g. some features in the user registration process, a user Id might not be given yet. In such cases, you can choose to use any user meta field as the unique identification for users.</p>

<p><strong>matchingUserMeta</strong>: this is more advanced eligibility control. You can set a field and regex pair to match user meta. Only users whose metadata field value matches the regex are eligible for the experiment.</p>

<p><strong>reshuffle</strong>: by default Thomas will try to keep the user assignment consistent between different versions of experiments of a feature. Setting this field to true will redistribute users again among all groups.</p>

<p><strong>segmentRanges</strong>: this field is used for creating mutually exclusive tests. When Thomas segments users into different groups, it hashes the user Id to a number between 0 and 1. If an A/B test is set with a set of segment ranges, then only hashes within that range will be eligible for that test. Thus if two tests have non-overlapping segment ranges, they will be mutually exclusive, i.e. users who eligible for one will not be eligible for the other.</p>
</div></div></section></main><footer id="site-footer"><div class="container"><div class="row"><div class="col-xs-6"><p>thomas is designed and developed by <a href="https://github.com/iheartradio/thomas" target="_blank">@kailuowang</a></p></div><div class="col-xs-6"><p class="text-right"><a href="https://github.com/Kailuo Wang/thomas"><span class="fa fa-github"></span>View on GitHub</a></p></div></div><div class="row"><div class="col-xs-6"><p>Website built with <a href="https://47deg.github.io/sbt-microsites/" target="_blank">Sbt-microsites</a> - © 2016 <a href="https://www.47deg.com/" target="_blank">47 Degrees</a></p></div></div></div></footer><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/thomas/highlight/highlight.pack.js"></script><script>hljs.configure({
languages:['scala','java','bash']
});
hljs.initHighlighting();
             </script><script>((window.gitter = {}).chat = {}).options = {
room: 'Kailuo Wang/thomas'};</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script></body></html>