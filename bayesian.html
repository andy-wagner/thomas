<html><head><title>thomas: Bayesian Analysis</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="@kailuowang" /><meta name="description" content="Thomas, a library for A/B tests" /><meta name="og:image" content="/thomas/img/poster.png" /><meta name="og:title" content="thomas: Bayesian Analysis" /><meta name="og:site_name" content="thomas" /><meta name="og:url" content="https://github.com/iheartradio/thomas" /><meta name="og:type" content="website" /><meta name="og:description" content="Thomas, a library for A/B tests" /><link rel="icon" type="image/png" href="/thomas/img/favicon.png" /><meta name="twitter:title" content="thomas: Bayesian Analysis" /><meta name="twitter:image" content="https://github.com/iheartradio/thomasimg/poster.png" /><meta name="twitter:description" content="Thomas, a library for A/B tests" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/thomas/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/thomas/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/thomas/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/thomas/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/thomas/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/thomas/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/thomas/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/thomas/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/thomas/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/thomas/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/thomas/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/thomas/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/thomas/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/thomas/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/thomas/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/thomas/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/thomas/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/thomas/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/thomas/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/thomas/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/thomas/highlight/styles/atom-one-light.css" /><link rel="stylesheet" href="/thomas/css/style.css" /><link rel="stylesheet" href="/thomas/css/palette.css" /><link rel="stylesheet" href="/thomas/css/codemirror.css" /></head><body><header id="site-header"><div class="navbar-wrapper navbar-inverse"><div class="container"><div class="navbar-header"><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/thomas/" class="brand"><div class="icon-wrapper"><span>thomas</span></div></a></div><nav class="text-right"><ul class=""><li><a href="https://github.com/iheartradio/thomas"><i class="fa fa-github"></i><span class="hidden-xs">GitHub</span></a></li><li><a href="/thomas/api/com/iheart/thomas/index.html"><i class="fa fa-file-text"></i><span class="hidden-xs">API Documentation</span></a></li></ul></nav></div></div><div class="jumbotron" style="background-image:url('/thomas/img/jumbotron_pattern.png')"></div><div><ul class="horizontalNav">     <li><a class="" href="/thomas/">Home</a></li>  <li><a class="" href="/thomas/get-started.html">Get Started</a></li>  <li><a class="" href="/thomas/core.html">Core concepts</a></li>  <li><a class="" href="/thomas/FAQ.html">FAQ</a></li>  <li><a class=" active " href="/thomas/bayesian.html">Bayesian Analysis</a></li> </ul></div></header><main id="site-main"><section class="use"><div class="container"><div id="content"><p>Thomas provides a module thomas-analysis that can be used to perform Bayesian analysis for A/B test results. This library is built using the wonderful <a href="https://github.com/stripe/rainier">Bayesian inference library Rainier</a>.  Using this thomas-analysis, users can write analysis tools that compute a posterior distribution of the effect of the treatment v.s. control using Markov Chain Monte Carlo.</p>

<p>In its essence, the A/B test analysis’s main task is that, given the observed difference in analytics results between multiple treatment groups, pick the treatment that works best towards the goal for the product. The traditional frequentist approach has been trying to determine whether the difference observed is statistically significantly or not. The Bayesian analysis allows us to answer a different question: given the observed difference, what will be the risk of picking one treatment over another. In another sentence, what will be the maximum reduction of KPI in the scenario when one treatment is chosen over another but the real difference is the opposite of the one saw in the experiment.</p>

<p>The Bayesian A/B analysis tool in Thomas produces results that look like the following.</p>

<div class="highlighter-rouge"><pre class="highlight"><code> Group:   Treatment A
 Count:   53179
 Chance of better than control: 0.82692
 Expected Benefit: 0.03209179240152402
 Median Benefit: 0.02028449645941638
 Risk of Using: -0.014472377020694363
 Risk of Not Using: -0.05524666066837561
 Plot:
|                                                                                
|                                 ○                                              
|                                 ○○                                             
|                             ∘○· ○○ ∘                                           
|                             ○○○○○○ ○·                                          
|                          ∘∘·○○○○○○○○○··                                        
|                         ∘○○○○○○○○○○○○○○∘                                       
|                        ∘○○○○○○○○○○○○○○○○·○                                     
|                       ·○○○○○○○○○○○○○○○○○○○○                                    
|                      ○○○○○○○○○○○○○○○○○○○○○○                                    
|                     ·○○○○○○○○○○○○○○○○○○○○○○                                    
|                   ∘∘○○○○○○○○○○○○○○○○○○○○○○○∘∘                                  
|                 ∘∘○○○○○○○○○○○○○○○○○○○○○○○○○○○∘                                 
|                ·○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○∘                                
|               ∘○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○∘                               
|              ∘○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○∘·                             
|            ·∘○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○∘·                           
|            ○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○                          
|        ·∘○∘○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○∘∘                        
|    ·∘·○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○···                    
|··∘∘○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○∘∘··········  ·   ·
|--------|--------|--------|--------|--------|--------|--------|--------|--------
 -0.039   -0.023   -0.007   0.010    0.026    0.042    0.058    0.075    0.091  

</code></pre>
</div>

<p>To use these utilities users need to implement integration with data retrieval from their analytical system.</p>

<p>The core class that provides the Bayesian analysis is <a href="https://iheartradio.github.io/thomas/api/com/iheart/thomas/client/AnalysisAPI.html">AnalysisAPI</a> provided in <code class="highlighter-rouge">thomas-client</code></p>

<p>This API is parameterized to the effect type <code class="highlighter-rouge">F[_]</code> and KPI’s distribution type <code class="highlighter-rouge">K</code></p>
<div class="language-scala highlighter-rouge"><pre class="highlight"><code> <span class="k">trait</span> <span class="nc">AnalysisAPI</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]</span>, <span class="kt">K</span> <span class="k">&lt;:</span> <span class="kt">KPIDistribution</span><span class="o">]</span> 
</code></pre>
</div>
<p>KPI stands for Key Performance Indicator, it is what we use to evaluate the effect of a treatment. One example is the conversion (or click through) rate, another example is average user engagement time. Each KPI can be modeled as a certain type of distribution. For example conversion rate is often modeled using the Beta distribution. One can choose to use the Gamma distribution to model the user engagement time. In fact these are two types of KPI distributions Thomas supports out of box at the time of writing. User can implement their own <code class="highlighter-rouge">KPIDistribution</code>, it will require knowledge of Bayesian inference and <a href="https://github.com/stripe/rainier">Rainier</a> the MCMC library used in Thomas.</p>

<p>Thus depending on which type of KPI you are analyzing, you need to instantiate different type of <code class="highlighter-rouge">AnalysisAPI</code>. Take Gamma KPI distribution as an example:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">com.iheart.thomas.client._</span>
<span class="k">import</span> <span class="nn">com.iheart.thomas.client._</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">com.iheart.thomas.client.Client.HttpServiceUrlsSimple</span>
<span class="k">import</span> <span class="nn">com.iheart.thomas.client.Client.HttpServiceUrlsSimple</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">cats.effect.IO</span>
<span class="k">import</span> <span class="nn">cats.effect.IO</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">com.iheart.thomas.analysis.Measurable.GammaMeasurable</span>
<span class="k">import</span> <span class="nn">com.iheart.thomas.analysis.Measurable.GammaMeasurable</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="c1">//these are Url to your Thomas http service instance that provides tests and kpi endpoints
</span>     <span class="o">|</span> <span class="k">val</span> <span class="n">httpServiceUrl</span> <span class="k">=</span> <span class="nc">HttpServiceUrlsSimple</span><span class="o">(</span><span class="s">"http://localhost/tests"</span><span class="o">,</span> <span class="s">"http://localhost/kpi"</span><span class="o">)</span>
<span class="n">httpServiceUrl</span><span class="k">:</span> <span class="kt">com.iheart.thomas.client.Client.HttpServiceUrlsSimple</span> <span class="o">=</span> <span class="nc">HttpServiceUrlsSimple</span><span class="o">(</span><span class="n">http</span><span class="o">://</span><span class="n">localhost</span><span class="o">/</span><span class="n">tests</span><span class="o">,</span><span class="n">http</span><span class="o">://</span><span class="n">localhost</span><span class="o">/</span><span class="n">kpi</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="nc">Client</span><span class="o">.</span><span class="n">create</span><span class="o">[</span><span class="kt">IO</span><span class="o">](</span><span class="n">httpServiceUrl</span><span class="o">).</span><span class="n">use</span> <span class="o">{</span> <span class="k">implicit</span> <span class="n">client</span> <span class="k">=&gt;</span>
     <span class="o">|</span>   <span class="k">implicit</span> <span class="k">val</span> <span class="n">measurable</span><span class="k">:</span> <span class="kt">GammaMeasurable</span><span class="o">[</span><span class="kt">IO</span><span class="o">]</span> <span class="k">=</span> <span class="kc">null</span>  <span class="c1">//user needs to implement a GammaMeasurable, null used here so that code compiles 
</span>     <span class="o">|</span>   <span class="k">val</span> <span class="n">analysisAPI</span> <span class="k">=</span> <span class="nc">AnalysisAPI</span><span class="o">.</span><span class="n">defaultGamma</span><span class="o">[</span><span class="kt">IO</span><span class="o">]</span>
     <span class="o">|</span>   <span class="c1">//do something with analysisAPI
</span>     <span class="o">|</span>   <span class="nc">IO</span><span class="o">(</span><span class="n">println</span><span class="o">(</span><span class="s">"done"</span><span class="o">))</span> 
     <span class="o">|</span> <span class="o">}.</span><span class="n">unsafeRunSync</span>
<span class="o">[</span><span class="kt">WARN</span><span class="o">]</span> <span class="o">[</span><span class="err">04</span><span class="kt">/</span><span class="err">26</span><span class="kt">/</span><span class="err">2019</span> <span class="err">14</span><span class="kt">:</span><span class="err">53</span><span class="kt">:</span><span class="err">13</span><span class="kt">.</span><span class="err">526</span><span class="o">]</span> <span class="o">[</span><span class="kt">run-main-</span><span class="err">0</span><span class="o">]</span> <span class="o">[</span><span class="kt">ManifestInfo</span><span class="o">(</span><span class="kt">akka://default</span><span class="o">)]</span> <span class="nc">Detected</span> <span class="n">possible</span> <span class="n">incompatible</span> <span class="n">versions</span> <span class="n">on</span> <span class="n">the</span> <span class="n">classpath</span><span class="o">.</span> <span class="nc">Please</span> <span class="n">note</span> <span class="n">that</span> <span class="n">a</span> <span class="n">given</span> <span class="nc">Akka</span> <span class="n">version</span> <span class="nc">MUST</span> <span class="n">be</span> <span class="n">the</span> <span class="n">same</span> <span class="n">across</span> <span class="n">all</span> <span class="n">modules</span> <span class="n">of</span> <span class="nc">Akka</span> <span class="n">that</span> <span class="n">you</span> <span class="n">are</span> <span class="n">using</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="k">if</span> <span class="n">you</span> <span class="n">use</span> <span class="o">[</span><span class="err">2</span><span class="kt">.</span><span class="err">5</span><span class="kt">.</span><span class="err">22</span><span class="o">]</span> <span class="n">all</span> <span class="n">other</span> <span class="n">modules</span> <span class="n">that</span> <span class="n">are</span> <span class="n">released</span> <span class="n">together</span> <span class="nc">MUST</span> <span class="n">be</span> <span class="n">of</span> <span class="n">the</span> <span class="n">same</span> <span class="n">version</span><span class="o">.</span> <span class="nc">Make</span> <span class="n">sure</span> <span class="n">you</span><span class="ss">'re </span><span class="n">using</span> <span class="n">a</span> <span class="n">compatible</span> <span class="n">set</span> <span class="n">of</span> <span class="n">libraries</span><span class="o">.</span> <span class="nc">Possibly</span> <span class="n">conflicting</span> <span class="n">versions</span> <span class="o">[</span><span class="err">2</span><span class="kt">.</span><span class="err">5</span><span class="kt">.</span><span class="err">17</span>, <span class="err">2</span><span class="kt">.</span><span class="err">5</span><span class="kt">.</span><span class="err">22</span><span class="o">]</span> <span class="n">in</span> <span class="n">libraries</span> <span class="o">[</span><span class="kt">akka-protobuf:</span><span class="err">2</span><span class="kt">.</span><span class="err">5</span><span class="kt">.</span><span class="err">17</span>, <span class="kt">akka-actor:</span><span class="err">2</span><span class="kt">.</span><span class="err">5</span><span class="kt">.</span><span class="err">22</span>, <span class="kt">akka-slf4j:</span><span class="err">2</span><span class="kt">.</span><span class="err">5</span><span class="kt">.</span><span class="err">22</span>, <span class="kt">akka-stream:</span><span class="err">2</span><span class="kt">.</span><span class="err">5</span><span class="kt">.</span><span class="err">17</span><span class="o">]</span>
<span class="n">done</span>
</code></pre>
</div>
<p>Note that in this code the user needs to provide a Client instance which will be used to retrieve A/B tests information and manage KPI from the Thomas service. Uer also needs to implement a <code class="highlighter-rouge">GammaMeasurable</code>, an alias for <a href="https://iheartradio.github.io/thomas/api/com/iheart/thomas/analysis/Measurable.html">Measurable</a>. This trait is responsible for getting the raw measurements of users of each group from the Analytics data.</p>

<p>Once we have an instance of <code class="highlighter-rouge">AnalysisAPI</code>, we can</p>
<ol>
  <li>initialize a KPI with prior distribution using historical data</li>
  <li>update the KPI’s prior distribution using more recent historical data</li>
  <li>assess the results of an A/B test</li>
</ol>

<p>For more detail regarding these methods please check <a href="https://iheartradio.github.io/thomas/api/com/iheart/thomas/client/AnalysisAPI.html">AnalysisAPI’s API documentation</a></p>

</div></div></section></main><footer id="site-footer"><div class="container"><div class="row"><div class="col-xs-6"><p>thomas is designed and developed by <a href="https://github.com/iheartradio/thomas" target="_blank">@kailuowang</a></p></div><div class="col-xs-6"><p class="text-right"><a href="https://github.com/iheartradio/thomas"><span class="fa fa-github"></span>View on GitHub</a></p></div></div><div class="row"><div class="col-xs-6"><p>Website built with <a href="https://47deg.github.io/sbt-microsites/" target="_blank">Sbt-microsites</a> - © 2016 <a href="https://www.47deg.com/" target="_blank">47 Degrees</a></p></div></div></div></footer><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/thomas/highlight/highlight.pack.js"></script><script>hljs.configure({
languages:['scala','java','bash']
});
hljs.initHighlighting();
             </script><script>((window.gitter = {}).chat = {}).options = {
room: 'iheartradio/thomas'};</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script></body></html>